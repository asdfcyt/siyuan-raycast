# Assets 附件快速查找功能使用指南

这是为 SiYuan Raycast 扩展新开发的 Assets 附件快速查找功能，可以帮助您快速搜索和管理 SiYuan 笔记中的附件文件。

## 功能特色

- 🔍 **快速搜索**: 输入关键词快速搜索 assets 文件夹中的所有附件
- 📁 **类型筛选**: 按文件类型筛选（图片、文档、压缩包、视频、音频、其他）
- 📋 **多种操作**: 支持打开文件、在 Finder 中显示、复制到桌面等操作
- 📊 **智能显示**: 显示引用该附件的最新文档信息，或显示文件大小和修改日期
- 🔗 **路径复制**: 支持复制文件路径、文件名、相对路径等多种格式
- 📖 **文档跳转**: 可直接跳转到引用该附件的 SiYuan 文档
- 🚫 **智能过滤**: 自动过滤 SiYuan 内部文件（.sya 格式）

## 配置要求

### 必需配置
1. **工作空间路径**: 必须在扩展设置中配置 SiYuan 工作空间路径
   - 打开 Raycast 设置 → 扩展 → SiYuan Notes → 工作空间路径
   - 输入您的 SiYuan 工作空间完整路径，例如: `/Users/yourname/Documents/SiYuanWorkspace`

### 验证配置
如果配置不正确，扩展会显示配置提示并提供直接打开设置的按钮。

## 如何使用

### 1. 打开功能
在 Raycast 中输入 `Find Assets` 或 `查找附件` 命令

### 2. 搜索文件
- **全文搜索**: 在搜索框中输入文件名关键词
- **类型筛选**: 使用右侧下拉菜单按文件类型筛选
- **实时统计**: 搜索框显示当前找到的文件数量和总大小

### 3. 文件操作
对搜索结果中的文件，您可以进行以下操作：

#### 文件操作
- **⌘ + O**: 用默认应用打开文件
- **⌘ + R**: 在 SiYuan 中打开引用该附件的文档（如果有引用）
- **⌘ + F**: 在 Finder 中显示文件
- **⌘ + D**: 复制文件到桌面

#### 复制信息
- **⌘ + C**: 复制文件完整路径
- **⌘ + Shift + C**: 复制文件名
- **⌘ + Alt + C**: 复制相对路径（用于 SiYuan 引用）

#### 其他操作
- **⌘ + T**: 测试与 SiYuan 的连接

## 支持的文件类型

- **图片**: jpg, jpeg, png, gif, bmp, svg, webp, ico
- **文档**: pdf, doc, docx, txt, md, rtf, odt
- **压缩包**: zip, rar, 7z, tar, gz, bz2
- **视频**: mp4, avi, mov, wmv, flv, mkv, webm
- **音频**: mp3, wav, flac, aac, ogg, m4a
- **其他**: 其他所有文件类型

## 功能亮点

### 智能显示
- 如果附件被文档引用，优先显示引用该附件的最新文档名称和日期
- 如果附件未被引用，显示文件大小和修改日期
- 时间显示格式为 YYYY-MM-DD，简洁易读

### 智能复制
- 如果目标位置已存在同名文件，会自动重命名（添加时间戳）
- 复制操作完成后会显示成功提示

### 友好界面
- 不同文件类型显示不同颜色的图标
- 右侧显示文件扩展名和文件大小
- 搜索结果按文件名排序

### 智能过滤
- 自动过滤 SiYuan 内部文件（.sya 格式）
- 只显示真正的用户附件文件

### 错误处理
- 详细的错误提示信息
- 自动检测工作空间配置
- 提供快速打开设置的入口

## 常见问题

### Q: 搜索不到文件怎么办？
A: 请检查以下几点：
1. 确认工作空间路径配置正确
2. 确认 assets 文件夹存在且有读取权限
3. 尝试使用"测试连接"功能检查配置

### Q: 复制到桌面失败怎么办？
A: 请确认：
1. 有桌面文件夹的写入权限
2. 磁盘空间充足
3. 源文件没有被其他程序占用

### Q: 为什么看不到 .sya 文件？
A: .sya 文件是 SiYuan 的内部文件格式，已被自动过滤，只显示用户的实际附件。

### Q: 支持搜索子文件夹吗？
A: 当前版本只搜索 assets 根目录的文件，不包括子文件夹。

### Q: 如何知道哪个文档引用了这个附件？
A: 如果附件被引用，subtitle 会显示"被引用于: 文档名称 • 日期"，您可以使用 ⌘+R 直接跳转到该文档。

## 技术实现

- 使用 Node.js fs 模块直接读取文件系统
- 采用懒加载机制查找引用该附件的文档
- 使用防抖技术减少频繁查询
- 实现了引用信息缓存，避免重复查询
- 支持异步文件操作和错误处理
- 使用 Raycast API 提供的组件和功能
- 实现了智能的文件类型识别和图标显示
- 优化了日期格式显示

### 性能优化

- **懒加载**: 引用信息只在需要时才查询，避免初始加载时的大量数据库查询
- **防抖查询**: 搜索输入使用 500ms 防抖，减少不必要的查询
- **智能缓存**: 已查询的引用信息会被缓存，避免重复查询
- **分批处理**: 避免同时查询过多文件的引用信息
- **条件执行**: 只在工作空间配置正确时才执行查询

## 下一步改进

- [ ] 支持子文件夹搜索
- [ ] 添加文件预览功能
- [ ] 支持批量操作
- [ ] 添加更多排序选项
- [ ] 支持自定义文件操作
- [ ] 显示引用该附件的所有文档列表

---

如果您在使用过程中遇到任何问题，请及时反馈！